<!-- TODO
  Side Nav
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>I earned it.</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>
<body>
  <div class="navbar">
    <nav class="teal lighten-2" role="navigation">
      <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">i<b class="lime-text text-accent-1">earned</b>it</a>
        <ul class="right hide-on-med-and-down">
          <li><a href="#">Personal Finance Literacy</a></li>
          <li><a href="#">Log In</a></li>
          <li><a class="btn lime accent-1 black-text" href="#getStarted">Sign Up</a></li>
        </ul>

        <ul id="nav-mobile" class="sidenav">
          <li><a href="#">Navbar Link</a></li>
        </ul>
        <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      </div>
    </nav>
  </div>

  <div class="fixed-action-btn">
    <a class="btn-floating btn-large red lighten-1">
      <i class="large material-icons">menu</i>
    </a>
    <ul>
      <li><a class="btn-floating yellow darken-2"><i class="material-icons">insert_chart</i></a></li>
      <!-- <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li> -->
      <li><a href="#newEntry" class="btn-floating teal lighten-2"><i class="material-icons">add</i></a></li>
      <!-- <li><a class="btn-floating blue"><i class="material-icons">attach_file</i></a></li> -->
    </ul>
  </div>

  <div class="section no-pad-bot">
    <br>
    <div class="container">
      <!-- <h1 class="header teal-text text-lighten-3">Dashboard</h1>
      <br> -->
        <h4 class="light grey-text">2020</h4>
        <ul class="collapsible nested-collapsible-shadow">
          <li>
            <div class="collapsible-header">
              <h5 class="light grey-text"><i class="material-icons chevron">keyboard_arrow_right</i>February</h5>
            </div>
            <div class="collapsible-body">
              <ul class="collapsible nested-collapsible-shadow">
                <li>
                  <div class="light grey-text collapsible-header nested-collapsible">
                    <span><i class="material-icons chevron">keyboard_arrow_right</i>Pay Period 2</span>
                    <div class="right green-text text-lighten-2">$122</div>
                  </div>
                  <div class="collapsible-body">
                    <table>
                        <thead>
                          <th>Item</th>
                          <th>Category</th>
                          <th>Price</th>
                        </thead>
                        <tbody>
                          <tr class="cell">
                            <td class="text-darken-1 grey-text">Coffee</td>
                            <td class="text-darken-1 grey-text">Frivolous</td>
                            <td class="text-darken-1 grey-text">5.50</td>
                          </tr>
                          <tr class="cell">
                            <td class="text-darken-1 grey-text">Groceries</td>
                            <td class="text-darken-1 grey-text">Groceries</td>
                            <td class="text-darken-1 grey-text">120</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </li>
                  <li>
                    <div class="light grey-text collapsible-header nested-collapsible">
                      <span><i class="material-icons chevron">keyboard_arrow_right</i>Pay Period 1</span>
                      <div class="right red-text text-lighten-2">$312</div>
                    </div>
                    <div class="collapsible-body">
                      <table>
                          <thead>
                            <th>Item</th>
                            <th>Category</th>
                            <th>Price</th>
                          </thead>
                          <tbody>
                            <tr class="cell">
                              <td class="text-darken-1 grey-text">Coffee</td>
                              <td class="text-darken-1 grey-text">Frivolous</td>
                              <td class="text-darken-1 grey-text">5.50</td>
                            </tr>
                            <tr class="cell">
                              <td class="text-darken-1 grey-text">Groceries</td>
                              <td class="text-darken-1 grey-text">Groceries</td>
                              <td class="text-darken-1 grey-text">120</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                  </li>
                </ul>
            </div>
          </li>
          <li>
            <div class="collapsible-header">
              <h5 class="light grey-text"><i class="material-icons chevron">keyboard_arrow_right</i>January</h5>
            </div>
            <div class="collapsible-body">
              <ul class="collapsible nested-collapsible-shadow">
              <li>
                <div class="light grey-text collapsible-header nested-collapsible">
                  <span><i class="material-icons chevron">keyboard_arrow_right</i>Pay Period 3</span>
                  <div class="right red-text text-lighten-2">$100</div>
                </div>
                <div class="collapsible-body">
                  <table>
                      <thead>
                        <th>Item</th>
                        <th>Category</th>
                        <th>Price</th>
                      </thead>
                      <tbody>
                        <tr class="cell">
                          <td class="text-darken-1 grey-text">Coffee</td>
                          <td class="text-darken-1 grey-text">Frivolous</td>
                          <td class="text-darken-1 grey-text">5.50</td>
                        </tr>
                        <tr class="cell">
                          <td class="text-darken-1 grey-text">Groceries</td>
                          <td class="text-darken-1 grey-text">Groceries</td>
                          <td class="text-darken-1 grey-text">120</td>
                        </tr>
                      </tbody>
                    </table>
                </div>
              </li>
              <li>
                <div class="light grey-text collapsible-header nested-collapsible">
                  <span><i class="material-icons chevron">keyboard_arrow_right</i>Pay Period 2</span>
                  <div class="right red-text text-lighten-2">$100</div>
                </div>
                <div class="collapsible-body">
                  <table>
                      <thead>
                        <th>Item</th>
                        <th>Category</th>
                        <th>Price</th>
                      </thead>
                      <tbody>
                        <tr class="cell">
                          <td class="text-darken-1 grey-text">Coffee</td>
                          <td class="text-darken-1 grey-text">Frivolous</td>
                          <td class="text-darken-1 grey-text">5.50</td>
                        </tr>
                        <tr class="cell">
                          <td class="text-darken-1 grey-text">Groceries</td>
                          <td class="text-darken-1 grey-text">Groceries</td>
                          <td class="text-darken-1 grey-text">120</td>
                        </tr>
                      </tbody>
                    </table>
                </div>
              </li>
              <li>
                <div class="light grey-text collapsible-header nested-collapsible">
                  <span><i class="material-icons chevron">keyboard_arrow_right</i>Pay Period 1</span>
                  <div class="right green-text text-lighten-2">$300</div>
                </div>
                <div class="collapsible-body">
                  <table>
                    <thead>
                      <th>Item</th>
                      <th>Category</th>
                      <th>Price</th>
                    </thead>
                    <tbody>
                      <tr class="cell">
                        <td class="text-darken-1 grey-text">Coffee</td>
                        <td class="text-darken-1 grey-text">Frivolous</td>
                        <td class="text-darken-1 grey-text">5.50</td>
                      </tr>
                      <tr class="cell">
                        <td class="text-darken-1 grey-text">Groceries</td>
                        <td class="text-darken-1 grey-text">Groceries</td>
                        <td class="text-darken-1 grey-text">120</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </li>
            </ul>
            </div>
          </li>
        </ul>
          
        <br>
        <h4 class="light grey-text">2019</h4>
        <ul class="collapsible nested-collapsible-shadow">
          <li>
            <div class="collapsible-header">
              <h5 class="light grey-text"><i class="material-icons chevron">keyboard_arrow_right</i>December</h5>
            </div>
            <div class="collapsible-body">
              <ul class="collapsible nested-collapsible-shadow">
                <li>
                  <div class="light grey-text collapsible-header nested-collapsible">
                    <span>Pay Period 2</span>
                    <div class="right green-text text-lighten-2">$122</div>
                  </div>
                  <div class="collapsible-body">
                    <table>
                        <thead>
                          <th>Item</th>
                          <th>Category</th>
                          <th>Price</th>
                        </thead>
                        <tbody>
                          <tr class="cell">
                            <td class="text-darken-1 grey-text">Coffee</td>
                            <td class="text-darken-1 grey-text">Frivolous</td>
                            <td class="text-darken-1 grey-text">5.50</td>
                          </tr>
                          <tr class="cell">
                            <td class="text-darken-1 grey-text">Groceries</td>
                            <td class="text-darken-1 grey-text">Groceries</td>
                            <td class="text-darken-1 grey-text">120</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </li>
                  <li>
                    <div class="light grey-text collapsible-header nested-collapsible">
                      <span>Pay Period 1</span>
                      <div class="right red-text text-lighten-2">$312</div>
                    </div>
                    <div class="collapsible-body">
                      <table>
                          <thead>
                            <th>Item</th>
                            <th>Category</th>
                            <th>Price</th>
                          </thead>
                          <tbody>
                            <tr class="cell">
                              <td class="text-darken-1 grey-text">Coffee</td>
                              <td class="text-darken-1 grey-text">Frivolous</td>
                              <td class="text-darken-1 grey-text">5.50</td>
                            </tr>
                            <tr class="cell">
                              <td class="text-darken-1 grey-text">Groceries</td>
                              <td class="text-darken-1 grey-text">Groceries</td>
                              <td class="text-darken-1 grey-text">120</td>
                            </tr>
                          </tbody>
                        </table>
                    </div>
                  </li>
                </ul>
            </div>
          </li>
        </ul>
      </div>

  <!-- New Entry -->
  <div class="container">
    <br>
    <!-- <hr> -->
    <br>
    <h3 id="newEntry" class="light teal-text text-lighten-3">New Entry</h3>
    
    <form>
      <div class="row">
        <div class="input-field col s4">
          <input id="income" type="number" class="validate" required>
          <label>Amount Earned</label>
        </div>
        <div class="input-field col s4">
          <input id="savings" type="number" class="validate" required>
          <label>Savings per Pay Period Goal</label>
        </div>
        <div class="input-field col s4">
          <input id="date" type="text" class="datepicker validate" required>
          <label>Pay Date</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s6">
          <input disabled value="Surplus" id="surplus" type="text" class="hide black-text validate">
        </div>
      </div>
      <!-- <br> -->

      <table id="entryTable">
        <thead>
          <th>Item</th>
          <th>Category</th>
          <th>Price</th>
        </thead>
        <tbody>
          <tr class="cell">
            <td><input placeholder="Enter Item" type="text" class="cell" required></td>
            <td>
              <select class="cell validate" type="text" required>
                <!-- TODO: Include a button for a modal for each option to describe what falls under the category -->
                  <option value="" disabled selected>Choose Category</option>
                  <option value="home">Home</option>
                  <option value="transportation">Transportation</option>
                  <option value="essentials">Essentials</option>
                  <option value="Frivolous">Frivolous</option>
                  <option value="personal">Personal Spending</option>
                  <option value="miscellaneous">Miscellaneous</option>
                  <option value="frivolous">Frivolous</option>
              </select>
            </td>
            <td><input placeholder="Enter Price" type="number" class="cell price" required></td>
            <td>&emsp;<a onclick="addRow(event)" class="btn-floating btn-large waves-effect waves-light teal-text"><i class="material-icons">add</i></a></td>
          </tr>
        </tbody>
      </table>
      <div class="center">
        <button class="btn-large waves-effect waves-light lime accent-1 black-text" type="submit" name="action">Submit
          <i class="material-icons right">launch</i>
        </button>
      </div>
    </form>
    </div>

    <br><br>

  <!-- Footer -->
  <footer class="page-footer teal lighten-2">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Donate</h5>
          <p class="grey-text text-lighten-4">
            Please consider donating to iearned.it. Donations will go either directly back
            into the site or to an education-focused charity.
          </p>
        </div>
        <div class="col l3 s12">
          <h5 class="white-text">Resources</h5>
          <ul>
            <li><a class="lime-text text-accent-1" href="#!">Personal Finance Literacy</a></li>
            <li><a class="lime-text text-accent-1" href="https://www.reddit.com/r/personalfinance/wiki/commontopics" target="_blank" rel="noopener noreferrer">
              Reddit Personal Finance Guide
            </a></li>
            <li><a class="lime-text text-accent-1" href="https://www.reddit.com/r/personalfinance/wiki/index" target="_blank" rel="noopener noreferrer">
              Reddit Personal Finance Wiki
            </a></li>
          </ul>
        </div>
        <div class="col l3 s12">
          <h5 class="white-text">Connect</h5>
          <ul class="footer-link">
            <li><a class="lime-text text-accent-1" href="#!"><i class="material-icons">email</i></a></li>
            <li><a class="lime-text text-accent-1" href="#!">GitHub</a></li> <!--Github icon-->
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Inspired by <a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize</a>
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
   <script>
      document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.collapsible');
        var options = {
          onCloseStart: function(collapsible, trigger) {
            arrowUp(collapsible.firstElementChild.firstElementChild.firstElementChild);
          },
          onOpenStart: function (collapsible, trigger) {
            arrowDown(collapsible.firstElementChild.firstElementChild.firstElementChild);
          }
        }
        var instances = M.Collapsible.init(elems, options);
      });
     $(document).ready(function(){
      $('select').formSelect();
      $('.datepicker').datepicker();
      // $('.collapsible').collapsible();
      $('.sidenav').sidenav();
      $('.fixed-action-btn').floatingActionButton();

      // var elems = document.querySelectorAll('.collapsible');
      // var instances = M.Sidenav.init(elems, {
      //   onCloseStart: function() {console.log("onCloseStart");}
      // });
     });

     function addRow(e) {
       console.log(e)
       // e.srcElement.innerHTML = 'delete'
       var values = getValues()
       var income = values.income
       var goal = values.goal
       var total = values.total
       var surplus = values.surplus
       var toasts = []
       var toastClasses = ""
       if (total > 0 && income > 0 && goal > 0 && income > goal) {
         $('<tr class="cell">\
            <td><input placeholder="Enter Item" type="text" class="cell"></td>\
             <select class="cell">\
               <!-- TODO: Include a button for a modal for each option to describe what falls under the category -->\
                 <option value="" disabled selected>Choose Category</option>\
                 <option value="home">Home</option>\
                 <option value="transportation">Transportation</option>\
                 <option value="essentials">Essentials</option>\
                 <option value="Frivolous">Frivolous</option>\
                 <option value="personal">Personal Spending</option>\
                 <option value="miscellaneous">Miscellaneous</option>\
                 <option value="frivolous">Frivolous</option>\
             </select>\
             <td><input placeholder="Enter Category" type="text" class="cell"></td>\
             <td><input placeholder="Enter Price" type="number" class="cell price"></td>\
             <td>&emsp;<a onclick="addRow(event)" class="btn-floating btn-large waves-effect waves-light teal-text"><i class="material-icons">add</i></a></td>\
          </tr>').appendTo($("#entryTable"))
         var parent = e.srcElement.parentNode
         parent.outerHTML = '<a onclick="deleteRow(event)" class="btn-floating btn-large waves-effect waves-light teal-text"><i class="material-icons">delete</i></a>'
          
         if (surplus < 0) {
           toastClasses += "red"
         }
         var toastHtml = getToastHtml(surplus)
         $('#surplus').val(toastHtml);
         $("#surplus").removeClass('hide');
         toasts.push(toastHtml)
       } else {  
         if (total === 0) {
           toasts.push("Please enter a price for your item ")
         }
         if (income === 0 || isNaN(income)) {
           toasts.push("Please enter your income for the pay period")
         }
         if (goal === 0 || isNaN(goal)) {
           toasts.push("C'mon, you can save more than $0!")
         }
       }
       for (i = 0; i < toasts.length; i++) {
         M.toast({html: toasts[i], classes: toastClasses});
       }
     }

     function getValues() {
      var income = parseFloat($('#income').val())
      var goal = parseFloat($('#savings').val())
      var total = getTotal()
      var surplus = income - total - goal
      return {
        income: income,
        goal: goal,
        total: total,
        surplus: surplus
      }
     }

     function getToastHtml(surplus) {
       if (surplus > 0) {
        var toastHtml = "Extra spending money: $" + surplus
       } else if (surplus === 0) {
        var toastHtml = "Careful! You're right at your limit."
       } else {
        var toastHtml = "Uh-oh! You are under your savings goal by $" + (-surplus) + ". Keep trying!"
       }
       return toastHtml
     }

     function deleteRow(e) {
       var rowIndex = e.srcElement.parentNode.parentNode.parentNode.rowIndex
       document.getElementById('entryTable').deleteRow(rowIndex);
       var count = $('#entryTable tr').length;
       var values = getValues()
       var income = values.income
       var goal = values.goal
       var total = values.total
       var surplus = values.surplus
       var toastClasses = ""
       if (surplus < 0) {
         toastClasses += "red"
       }
       var toastHtml = getToastHtml(surplus)
       M.toast({html: toastHtml, classes: toastClasses});
       $('#surplus').val(toastHtml);
       
       // If only one row left, need to hide surplus form element
       // Why is count 2?
       if (count == 2) {
        $('#surplus').val("");
        $("#surplus").addClass('hide');
       }
     }

     function getTotal() {
       var total = 0
       $('#entryTable .price').each(function() {
        var val = parseFloat($(this).val());
        console.log(val)
        if ($.isNumeric(val)) {
          total += val
       }
      });
      return total;
     }

     function arrowDown(e) {
       e.innerHTML = "keyboard_arrow_down"
     }
     function arrowUp(e) {
       e.innerHTML = "keyboard_arrow_right"
     }

    document.querySelector('form').addEventListener('submit', function(e) {
      const params = new Map(location.search.slice(1).split('&').map(kv => kv.split('=')))
      // TODO: Pass params to DynamoDB
      console.log(params.get('email'))
    });
   </script>
  </body>
</html>
